<div class="sidebar" [class.collapsed]="isCollapsed">
  <!-- Navigation Section -->
  <div class="sidebar-nav">

    <!-- Collapsed Navigation -->
    <div *ngIf="isCollapsed" class="collapsed-navigation">
      <!-- Home button -->
      <div class="collapsed-section-btn">
        <button 
          class="section-icon-btn home-btn"
          title="Home"
          routerLink="/"
          (click)="onPageClick()">
          <i class="bi bi-house-fill"></i>
        </button>
      </div>
      
      <!-- Section buttons -->
      <div *ngFor="let section of navigation; trackBy: trackByTitle" class="collapsed-section-btn">
        <button 
          class="section-icon-btn"
          [class.active]="isItemActive(section)"
          [title]="section.title"
          (click)="section.route ? navigateToItem(section) : toggleSection(section)">
          <i [class]="section.icon"></i>
        </button>
      </div>
    </div>

    <!-- Expanded Navigation -->
    <div *ngIf="!isCollapsed">
      <!-- Home Link -->
      <div class="nav-section mb-2">
        <div class="section-header home-section" 
             routerLink="/" 
             routerLinkActive="active"
             [routerLinkActiveOptions]="{exact: true}"
             (click)="onPageClick()">
          <div class="section-content-wrapper">
            <i class="bi bi-house-fill me-2"></i>
            <strong>Home</strong>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center p-3">
        <div class="spinner-border spinner-border-sm" role="status">
          <span class="visually-hidden">Loading navigation...</span>
        </div>
        <p class="mt-2 small">Loading navigation...</p>
      </div>

      <!-- Navigation Content -->
      <div class="nav-sections" *ngIf="!isLoading">
        
        <!-- Expanded state: Full navigation -->
        <div class="expanded-navigation">
          <!-- Navigation Items -->
          <div class="nav-section" *ngFor="let item of navigation; trackBy: trackByTitle">
            
            <!-- Item Header -->
            <div class="section-header" (click)="toggleSection(item)">
              <div class="section-content-wrapper" 
                   [class.has-content]="!!item.route"
                   (click)="onItemClick($event, item)">
                <i [class]="item.icon + ' me-2'"></i>
                <strong>{{ item.title }}</strong>
              </div>
              <i class="bi chevron-icon" 
                 [class.bi-chevron-down]="item.isExpanded"
                 [class.bi-chevron-right]="!item.isExpanded"
                 *ngIf="item.children && item.children.length > 0"></i>
            </div>
            
            <!-- Item Children (Recursive) -->
            <div class="section-content" *ngIf="item.isExpanded && item.children && item.children.length > 0">
              <ng-container *ngTemplateOutlet="navigationLevel; context: { $implicit: item.children, level: 1 }"></ng-container>
            </div>
            
          </div>
          
          <!-- Empty State -->
          <div *ngIf="navigation.length === 0" class="text-center p-3">
            <p class="text-muted">No navigation available</p>
          </div>
          
        </div> <!-- End expanded-navigation -->

        <!-- Recursive template for navigation levels -->
        <ng-template #navigationLevel let-items let-level="level">
          <div *ngFor="let item of items; trackBy: trackByTitle" 
               class="nav-item" 
               [class]="'level-' + level">
            
            <!-- If item has children, show as expandable -->
            <div *ngIf="item.children && item.children.length > 0; else leafItem">
              <div class="subsection-header" (click)="toggleSection(item)">
                <div class="subsection-content-wrapper" 
                     [class.has-content]="!!item.route"
                     (click)="onItemClick($event, item)">
                  <i [class]="item.icon + ' me-2'"></i>
                  <span>{{ item.title }}</span>
                </div>
                <i class="bi chevron-icon" 
                   [class.bi-chevron-down]="item.isExpanded"
                   [class.bi-chevron-right]="!item.isExpanded"></i>
              </div>
              
              <!-- Nested children -->
              <div class="subsection-content" *ngIf="item.isExpanded">
                <ng-container *ngTemplateOutlet="navigationLevel; context: { $implicit: item.children, level: level + 1 }"></ng-container>
              </div>
            </div>
            
            <!-- Leaf item template -->
            <ng-template #leafItem>
              <a [routerLink]="item.route" 
                 class="page-link"
                 routerLinkActive="active"
                 (click)="onPageClick()">
                <i [class]="item.icon + ' me-2'"></i>
                {{ item.title }}
              </a>
            </ng-template>
            
          </div>
        </ng-template>
    </div> <!-- End nav-sections -->
  </div>

  <!-- Collapsed state toggle - mobile only -->
  <div class="text-center py-2 d-md-none" *ngIf="isCollapsed">
    <button class="btn btn-link" (click)="toggleSidebar()">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>

  <!-- Floating Desktop Toggle Button - Bottom Right -->
  <button class="floating-toggle-btn d-none d-md-block" (click)="toggleSidebar()">
    <i class="bi bi-chevron-left" *ngIf="!isCollapsed"></i>
    <i class="bi bi-chevron-right" *ngIf="isCollapsed"></i>
  </button>

  <!-- Copyright Section -->
  <div class="sidebar-footer" [class.collapsed]="isCollapsed">
    <div class="copyright-text">
      <span class="copyright-year">Â© 2025</span>
      <span class="copyright-name">Christian Haliga</span>
    </div>
  </div>
</div>
